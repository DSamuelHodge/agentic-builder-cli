/* {{ pascal_name }} Agent (TypeScript)
 * This is an opinionated skeleton for a Restack Agent written in TS.
 * NOTE: Replace SDK imports with the official Restack Node SDK symbols.
 */

import type { ToolDefinition, LLMProvider, AgentContext, Message } from "./types";
// Example (adjust to real SDK):
// import { createAgent } from "@restack/agent";

export interface {{ pascal_name }}Config {
  model?: string;
  temperature?: number;
  systemPrompt?: string;
}

export const {{ name }}Tools: ToolDefinition[] = [
  // Example tool
  {
    name: "echo",
    description: "Echo a message back to the caller.",
    inputSchema: { type: "object", properties: { text: { type: "string" } }, required: ["text"] },
    handler: async (args, ctx) => {
      ctx.log.debug("[echo] args:", args);
      return { text: String(args.text ?? "") };
    },
  },
];

export function create{{ pascal_name }}(
  llm: LLMProvider,
  cfg: {{ pascal_name }}Config = {}
) {
  const settings = {
    model: cfg.model ?? "gpt-4o-mini",
    temperature: cfg.temperature ?? 0.2,
    systemPrompt:
      cfg.systemPrompt ??
      `You are {{ pascal_name }}, a helpful agent for the {{ app_name }} app.`,
  };

  // Pseudo-agent factory – replace with Restack’s actual agent constructor
  const agent = {
    name: "{{ pascal_name }}",
    tools: {{ name }}Tools,
    async run(messages: Message[], ctx: AgentContext) {
      // Call LLM with tool choices; wire actual SDK call here.
      const last = messages[messages.length - 1]?.content ?? "";
      ctx.log.info("{{ pascal_name }} received:", last);

      // Minimal “tool-call first” example
      if (last?.startsWith("/echo ")) {
        const text = last.slice(6);
        const res = await {{ name }}Tools[0].handler({ text }, ctx);
        return [{ role: "tool", name: "echo", content: JSON.stringify(res) } as Message];
      }

      // Otherwise delegate to LLM provider (mocked)
      const reply = await llm.complete({
        model: settings.model,
        temperature: settings.temperature,
        system: settings.systemPrompt,
        messages,
        tools: {{ name }}Tools,
      });

      return reply.messages;
    },
  };

  return agent;
}